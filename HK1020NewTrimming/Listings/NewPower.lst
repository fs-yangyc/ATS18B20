C51 COMPILER V9.56.0.0   NEWPOWER                                                          07/18/2019 16:27:57 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE NEWPOWER
OBJECT MODULE PLACED IN .\Objects\NewPower.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE NewPower.c LARGE OPTIMIZE(4,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Lis
                    -tings\NewPower.lst) OBJECT(.\Objects\NewPower.obj)

line level    source

   1          #include <NewPower.h>
   2          #include <DelayTime.h>
   3          
   4          unsigned char code nPwrMAX5821[8] = {0x80,0x40,0x20,0x10,0x08,0x04,0x02,0x01};
   5          void ResetMax5821I2CPort(void)
   6          {
   7   1              MAX5821_SCL = 0x01;
   8   1              MAX5821_SDA = 0x01;
   9   1      }
  10          
  11          void MAX5821I2CStart(void)
  12          {
  13   1              ResetMax5821I2CPort();
  14   1              Delay_MS(1);
  15   1              
  16   1              MAX5821_SDA = 0x00;
  17   1              Delay_5US();
  18   1              MAX5821_SCL = 0x00;
  19   1              Delay_5US();
  20   1      }
  21          
  22          void MAX5821I2CAck(void)
  23          {
  24   1              MAX5821_SDA = 0x01;
  25   1              Delay_5US();
  26   1              MAX5821_SCL = 0x01;
  27   1              Delay_5US();
  28   1              MAX5821_SCL = 0x00;
  29   1              Delay_5US();
  30   1      }
  31          
  32          void MAX5821I2CStop(void)
  33          {
  34   1              MAX5821_SDA = 0x00;
  35   1              Delay_5US();
  36   1              MAX5821_SCL = 0x01;
  37   1              Delay_5US();
  38   1              MAX5821_SDA = 0x01;
  39   1              Delay_5US();
  40   1      }
  41          
  42          void WriteDataToMAX5821(unsigned char nDeviceAddr,int nData, unsigned char nCommand)
  43          {
  44   1              char nBitCunt;
  45   1              unsigned char nDataByte1,nDataByte2;
  46   1              
  47   1              nDataByte2 = nData;
  48   1              nDataByte1 = 0xc0 | (nData >> 0x08);
  49   1              
  50   1              MAX5821I2CStart();
  51   1              for(nBitCunt = 0; nBitCunt < 8; nBitCunt++){
  52   2                      if(nDeviceAddr & nPwrMAX5821[nBitCunt]){
  53   3                              MAX5821_SDA = 0x01;
  54   3                      }
C51 COMPILER V9.56.0.0   NEWPOWER                                                          07/18/2019 16:27:57 PAGE 2   

  55   2                      
  56   2                      else{
  57   3                              MAX5821_SDA = 0x00;
  58   3                      }
  59   2                      
  60   2                      Delay_5US();
  61   2                      MAX5821_SCL = 0x01;
  62   2                      Delay_5US();
  63   2                      MAX5821_SCL = 0x00;
  64   2              }
  65   1              
  66   1              MAX5821I2CAck();
  67   1              for(nBitCunt = 0; nBitCunt < 8; nBitCunt++){
  68   2                      if(nDataByte1 & nPwrMAX5821[nBitCunt]){
  69   3                              MAX5821_SDA = 0x01;
  70   3                      }
  71   2                      
  72   2                      else{
  73   3                              MAX5821_SDA = 0x00;
  74   3                      }
  75   2                      
  76   2                      Delay_5US();
  77   2                      MAX5821_SCL = 0x01;
  78   2                      Delay_5US();
  79   2                      MAX5821_SCL = 0x00;
  80   2              }
  81   1              
  82   1              MAX5821I2CAck();
  83   1              for(nBitCunt = 0; nBitCunt < 8; nBitCunt++){
  84   2                      if(nDataByte2 & nPwrMAX5821[nBitCunt]){
  85   3                              MAX5821_SDA = 0x01;
  86   3                      }
  87   2                      
  88   2                      else{
  89   3                              MAX5821_SDA = 0x00;
  90   3                      }
  91   2                      
  92   2                      Delay_5US();
  93   2                      MAX5821_SCL = 0x01;
  94   2                      Delay_5US();
  95   2                      MAX5821_SCL = 0x00;
  96   2              }
  97   1              
  98   1              MAX5821I2CAck();
  99   1              MAX5821I2CStop();
 100   1              
 101   1              MAX5821I2CStart();
 102   1              for(nBitCunt = 0; nBitCunt < 8; nBitCunt++){
 103   2                      if(nDeviceAddr & nPwrMAX5821[nBitCunt]){
 104   3                              MAX5821_SDA = 0x01;
 105   3                      }
 106   2                      
 107   2                      else{
 108   3                              MAX5821_SDA = 0x00;
 109   3                      }
 110   2                      
 111   2                      Delay_5US();
 112   2                      MAX5821_SCL = 0x01;
 113   2                      Delay_5US();
 114   2                      MAX5821_SCL = 0x00;
 115   2              }
 116   1              
C51 COMPILER V9.56.0.0   NEWPOWER                                                          07/18/2019 16:27:57 PAGE 3   

 117   1              MAX5821I2CAck();
 118   1              for(nBitCunt = 0; nBitCunt < 8; nBitCunt++){
 119   2                      if(nCommand & nPwrMAX5821[nBitCunt]){
 120   3                              MAX5821_SDA = 0x01;
 121   3                      }
 122   2                      
 123   2                      else{
 124   3                              MAX5821_SDA = 0x00;
 125   3                      }
 126   2                      
 127   2                      Delay_5US();
 128   2                      MAX5821_SCL = 0x01;
 129   2                      Delay_5US();
 130   2                      MAX5821_SCL = 0x00;
 131   2              }
 132   1              
 133   1              MAX5821I2CAck();
 134   1              MAX5821I2CStop();
 135   1      }
 136          
 137          void SetVoltage(float fVoltage,char nOnOff)
 138          {
 139   1              int nDigtal;
 140   1              float fVref = 5.0;
 141   1              
 142   1              if(ON == nOnOff){
 143   2                      if(ON != POWER_N){
 144   3                              WriteDataToMAX5821(0x20,0x0000,0x40);
 145   3                              Delay_MS(10);
 146   3                              POWER_N = ON;
 147   3                              Delay_MS(50);
 148   3                      }
 149   2                      
 150   2                      nDigtal = fVoltage * 4096.0 / (2.0 * fVref); // 输出电压被放大了2倍
 151   2                      WriteDataToMAX5821(0x20,nDigtal,0x40);
 152   2                      Delay_MS(50);
 153   2              }
 154   1              
 155   1              else{
 156   2                      WriteDataToMAX5821(0x20,0x0000,0x40);
 157   2                      Delay_MS(10);
 158   2                      POWER_N = OFF;
 159   2                      Delay_MS(50);
 160   2              }
 161   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    606    ----
   CONSTANT SIZE    =      8    ----
   XDATA SIZE       =   ----      14
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
